{"componentChunkName":"component---src-templates-notes-js","path":"/notes/python-deepwatch/","result":{"data":{"markdownRemark":{"id":"b2e14b4e-4f6e-5d37-9810-e450b19c9d8d","html":"<p>Is it possible to deep watch a single python function for changes?</p>\n<h2>Shallow Watch</h2>\n<p>keeping track of a python functions hash is quite simple.  There is a<code class=\"language-text\">__hash__</code> method attached to every python function.  Calling it will return a hash of the function. If the function changes the hash will change.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">def</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n         <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">:</span>     <span class=\"token keyword\">return</span> <span class=\"token string\">\"hello\"</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> test<span class=\"token punctuation\">.</span>__hash__<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nOut<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8760526380347</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> test<span class=\"token punctuation\">.</span>__hash__<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nOut<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8760526380347</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">def</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n         <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">:</span>     <span class=\"token keyword\">return</span> <span class=\"token string\">\"hello world\"</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> test<span class=\"token punctuation\">.</span>__hash__<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nOut<span class=\"token punctuation\">[</span><span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8760525617988</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">6</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">def</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n         <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">:</span>     <span class=\"token keyword\">return</span> <span class=\"token string\">\"hello\"</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">7</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> test<span class=\"token punctuation\">.</span>__hash__<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nOut<span class=\"token punctuation\">[</span><span class=\"token number\">7</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8760526380491</span></code></pre></div>\n<p>Using hashlib provides a consistent hash.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> inspect\n<span class=\"token keyword\">import</span> hashlib\n<span class=\"token keyword\">def</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token string\">\"hello\"</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">17</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> m<span class=\"token punctuation\">.</span>update<span class=\"token punctuation\">(</span>inspect<span class=\"token punctuation\">.</span>getsource<span class=\"token punctuation\">(</span>test<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>encode<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">18</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> m\nOut<span class=\"token punctuation\">[</span><span class=\"token number\">18</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> <span class=\"token operator\">&lt;</span>sha256 HASH <span class=\"token builtin\">object</span> @ <span class=\"token number\">0x7f7b7b70fde0</span><span class=\"token operator\">></span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">19</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> m<span class=\"token punctuation\">.</span>hexdigest<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nOut<span class=\"token punctuation\">[</span><span class=\"token number\">19</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'1f2ff4c69eb69b545469686edd6f849136e104cd535785891586d90620328757'</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">20</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> m<span class=\"token punctuation\">.</span>update<span class=\"token punctuation\">(</span>inspect<span class=\"token punctuation\">.</span>getsource<span class=\"token punctuation\">(</span>test<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>encode<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">21</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> m<span class=\"token punctuation\">.</span>hexdigest<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nOut<span class=\"token punctuation\">[</span><span class=\"token number\">21</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'93638f2c944f34a9069af9242657b7de556fcc63742f4c27c4c8deedeb976a5f'</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">22</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> m <span class=\"token operator\">=</span> hashlib<span class=\"token punctuation\">.</span>sha256<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">23</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> m<span class=\"token punctuation\">.</span>update<span class=\"token punctuation\">(</span>inspect<span class=\"token punctuation\">.</span>getsource<span class=\"token punctuation\">(</span>test<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>encode<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">24</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> m<span class=\"token punctuation\">.</span>update<span class=\"token punctuation\">(</span>inspect<span class=\"token punctuation\">.</span>getsource<span class=\"token punctuation\">(</span>test<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>encode<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">25</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> m <span class=\"token operator\">=</span> hashlib<span class=\"token punctuation\">.</span>sha256<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">26</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> m<span class=\"token punctuation\">.</span>update<span class=\"token punctuation\">(</span>inspect<span class=\"token punctuation\">.</span>getsource<span class=\"token punctuation\">(</span>test<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>encode<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">27</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> m<span class=\"token punctuation\">.</span>hexdigest<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nOut<span class=\"token punctuation\">[</span><span class=\"token number\">27</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'1f2ff4c69eb69b545469686edd6f849136e104cd535785891586d90620328757'</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">28</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">def</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n          <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">:</span>     <span class=\"token keyword\">return</span> <span class=\"token string\">\"hello world\"</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">29</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> m <span class=\"token operator\">=</span> hashlib<span class=\"token punctuation\">.</span>sha256<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">30</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> m<span class=\"token punctuation\">.</span>update<span class=\"token punctuation\">(</span>inspect<span class=\"token punctuation\">.</span>getsource<span class=\"token punctuation\">(</span>test<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>encode<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">31</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> m<span class=\"token punctuation\">.</span>hexdigest<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nOut<span class=\"token punctuation\">[</span><span class=\"token number\">31</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'121fa3a3f295d49d4609505bc5e96d8b6a8ed3b496e4f3dc6c0ead73bef4e3c7'</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">32</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">def</span> <span class=\"token function\">test</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n          <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">:</span>     <span class=\"token keyword\">return</span> <span class=\"token string\">\"hello\"</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">33</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> m <span class=\"token operator\">=</span> hashlib<span class=\"token punctuation\">.</span>sha256<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">34</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> m<span class=\"token punctuation\">.</span>update<span class=\"token punctuation\">(</span>inspect<span class=\"token punctuation\">.</span>getsource<span class=\"token punctuation\">(</span>test<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>encode<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">[</span>ins<span class=\"token punctuation\">]</span> In <span class=\"token punctuation\">[</span><span class=\"token number\">35</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> m<span class=\"token punctuation\">.</span>hexdigest<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\nOut<span class=\"token punctuation\">[</span><span class=\"token number\">35</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'1f2ff4c69eb69b545469686edd6f849136e104cd535785891586d90620328757'</span></code></pre></div>\n<p>Now we have a consistent way to hash function code.</p>\n<h2>Deep hashing</h2>\n<h3>Find dependencies</h3>\n<p>setup a function in a module with a dependency</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">       │ File<span class=\"token punctuation\">:</span> one<span class=\"token punctuation\">.</span>py\n───────┼────────────────────────────────\n   <span class=\"token number\">1</span>   │ <span class=\"token keyword\">def</span> <span class=\"token function\">one</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n   <span class=\"token number\">2</span>   │     <span class=\"token keyword\">return</span> <span class=\"token number\">1</span>\n   <span class=\"token number\">3</span>   │\n   <span class=\"token number\">4</span>   │ <span class=\"token keyword\">def</span> <span class=\"token function\">two</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n   <span class=\"token number\">5</span>   │     <span class=\"token keyword\">return</span> one<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> one<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token operator\">>></span><span class=\"token operator\">></span> <span class=\"token keyword\">import</span> one\n<span class=\"token operator\">>></span><span class=\"token operator\">></span> one<span class=\"token punctuation\">.</span>one<span class=\"token punctuation\">.</span>__code__<span class=\"token punctuation\">.</span>co_names\n<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token operator\">>></span><span class=\"token operator\">></span> one<span class=\"token punctuation\">.</span>two<span class=\"token punctuation\">.</span>__code__<span class=\"token punctuation\">.</span>co_names\n<span class=\"token punctuation\">(</span><span class=\"token string\">'one'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">)</span></code></pre></div>\n<h2>Create Generic module importer by filepath</h2>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> importlib\n<span class=\"token keyword\">import</span> importlib<span class=\"token punctuation\">.</span>util\n<span class=\"token keyword\">import</span> os\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">_import</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">:</span> Path<span class=\"token punctuation\">,</span> directory<span class=\"token punctuation\">:</span> Path<span class=\"token punctuation\">,</span> verbose<span class=\"token punctuation\">:</span> <span class=\"token builtin\">bool</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"dynamically imports module given a path\"\"\"</span>\n    cwd <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>getcwd<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    os<span class=\"token punctuation\">.</span>chdir<span class=\"token punctuation\">(</span>directory<span class=\"token punctuation\">)</span>\n    name <span class=\"token operator\">=</span> path<span class=\"token punctuation\">.</span>name\n    <span class=\"token comment\"># path = str(path).replace(str(directory) + \"/\", \"\")</span>\n    path <span class=\"token operator\">=</span> _make_path_relative<span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">,</span> directory<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\n        spec <span class=\"token operator\">=</span> importlib<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>spec_from_file_location<span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> path<span class=\"token punctuation\">)</span>\n        module <span class=\"token operator\">=</span> importlib<span class=\"token punctuation\">.</span>util<span class=\"token punctuation\">.</span>module_from_spec<span class=\"token punctuation\">(</span>spec<span class=\"token punctuation\">)</span>\n        spec<span class=\"token punctuation\">.</span>loader<span class=\"token punctuation\">.</span>exec_module<span class=\"token punctuation\">(</span>module<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">except</span> <span class=\"token punctuation\">(</span>ModuleNotFoundError<span class=\"token punctuation\">,</span> ValueError<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        module <span class=\"token operator\">=</span> _use_importmodule<span class=\"token punctuation\">(</span>\n            <span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>replace<span class=\"token punctuation\">(</span>os<span class=\"token punctuation\">.</span>sep<span class=\"token punctuation\">,</span> <span class=\"token string\">\".\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>replace<span class=\"token punctuation\">(</span><span class=\"token string\">\".py\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> verbose<span class=\"token operator\">=</span>verbose\n        <span class=\"token punctuation\">)</span>\n    os<span class=\"token punctuation\">.</span>chdir<span class=\"token punctuation\">(</span>cwd<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> module\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">_use_importmodule</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">:</span> Path<span class=\"token punctuation\">,</span> verbose<span class=\"token punctuation\">:</span> <span class=\"token builtin\">bool</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token triple-quoted-string string\">\"\"\"\n    relative imports do not work well with importlib.util.spec_from_file_location,\n    and require a sys.path.append to be imported correctly.  For this reason\n    importlib.import_module is the second option.\n    \"\"\"</span>\n\n    <span class=\"token comment\"># Not sure if this is needed, but it was never hit in a test</span>\n    <span class=\"token comment\"># if path[0] == \".\":</span>\n    <span class=\"token comment\">#     path = path[1:]</span>\n\n    sys<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span>os<span class=\"token punctuation\">.</span>getcwd<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    mod <span class=\"token operator\">=</span> importlib<span class=\"token punctuation\">.</span>import_module<span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">)</span>\n    sys<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>pop<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># clean up path, do not permananatly change users path</span>\n    <span class=\"token keyword\">return</span> mod</code></pre></div>\n<h3>get code of dependency</h3>\n<p>the inspect module can tell us the filename of our current module.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> inspect\nmodule_path <span class=\"token operator\">=</span> inspect<span class=\"token punctuation\">.</span>getfile<span class=\"token punctuation\">(</span>one<span class=\"token punctuation\">.</span>one<span class=\"token punctuation\">)</span>\nmodule <span class=\"token operator\">=</span> _import<span class=\"token punctuation\">(</span>module_path<span class=\"token punctuation\">)</span></code></pre></div>\n<p>now we can hash the dependency</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">nested_function <span class=\"token operator\">=</span> <span class=\"token builtin\">eval</span><span class=\"token punctuation\">(</span>f'module<span class=\"token punctuation\">.</span><span class=\"token punctuation\">{</span>one<span class=\"token punctuation\">.</span>two<span class=\"token punctuation\">.</span>__code__<span class=\"token punctuation\">.</span>co_names<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span>\"</code></pre></div>","frontmatter":{"date":"2020-04-27T05:00:00.000Z","title":"python-deepwatch","description":"","path":"python-deepwatch","twitter_cover":null,"cover":null}}},"pageContext":{"id":"b2e14b4e-4f6e-5d37-9810-e450b19c9d8d"}}}