{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/how-to-get-dev-comments-from-an-article-url/","result":{"data":{"markdownRemark":{"id":"d775a10e-13cd-5b0c-86db-efe4037a5546","html":"<p>I want to incorporate some of the wonderful comments, ðŸ’•, ðŸ¦„, and ðŸ”–'s that I have been getting on <strong>dev.to</strong> on my website.  I have dabbled once or twice with no avail this time I am taking notes on my journey, so follow along and let's get there together.  By the end of this post, I will have a way to get comments from posts on the client-side thanks to the wonderfully open dev.to API.</p>\n<h2>The API</h2>\n<p>dev.to has an open API that allows us to easily get comments as HTML.  They have their API hosted at <a href=\"https://docs.dev.to/api/#tag/comments\">https://docs.dev.to/api/#tag/comments</a>, let's take a look at it.</p>\n<p><img src=\"https://waylonwalker.com/dev-to-api-comments.png\"></p>\n<p>Here we can see that going to <a href=\"https://dev.to/api/comments?a_id=270180\">https://dev.to/api/comments?a_id=270180</a> returns us some json, that contains an array of comments.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span>body_html<span class=\"token operator\">:</span> '&lt;the comment rendered as html>'<span class=\"token punctuation\">,</span>\n   user<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>&lt;an array with quite a bit of information about the commenting user><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n   children<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>&lt;an array of child comment objects><span class=\"token punctuation\">]</span>\n   &lt;other stuff we don't care about>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  &lt;more comments>\n  <span class=\"token punctuation\">]</span></code></pre></div>\n<h2>What the heck is that a_id</h2>\n<p>That is an <code class=\"language-text\">article_id</code>.  Though a bit of searching I found that it occurs in at least four places on every page as a data attribute.  Using chrome dev tools I found a good place to \"query\" it from.</p>\n<p><img src=\"https://waylonwalker.com/dev-to-article-id.png\"></p>\n<p>With this knowledge, we can fetch the contents of an article and pull the <code class=\"language-text\">articleId</code> from it.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">    <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getDevToAId</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">url</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// Gets the articleId of a dev.to article</span>\n        <span class=\"token keyword\">const</span> root <span class=\"token operator\">=</span> <span class=\"token string\">'https://dev.to/'</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>url<span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            url <span class=\"token operator\">=</span> root <span class=\"token operator\">+</span> url\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">let</span> domparser <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DOMParser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">const</span> html <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">r</span> <span class=\"token operator\">=></span> r<span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">const</span> doc <span class=\"token operator\">=</span> domparser<span class=\"token punctuation\">.</span><span class=\"token function\">parseFromString</span><span class=\"token punctuation\">(</span>html<span class=\"token punctuation\">,</span> <span class=\"token string\">'text/html'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">const</span> articleId <span class=\"token operator\">=</span> doc<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#article-body'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>dataset<span class=\"token punctuation\">.</span>articleId\n        <span class=\"token keyword\">return</span> articleId\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>note</strong>  I do check to see if a full URL or slug was given, if it was just the slug I tack on <code class=\"language-text\">https://dev.to/</code> before fetching.</p>\n<h2>Now the comments</h2>\n<p>The main event is here, what you all have waited for, and it's by far the easiest part.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">    <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getDevToComments</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">url</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> articleId <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">getDevToAId</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">https://dev.to/api/comments?a_id=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>articleId<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">const</span> comments <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> comments\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>The hardest part of this was figuring out what the <code class=\"language-text\">a_id</code> was and how I was going to get it from some more commonly known information about my articles, the URL, or the slug</p>\n<h2>Try it out</h2>\n<p><strong>F12</strong> pop open your console right in dev tools of this post and try it out.</p>\n<p><img src=\"https://waylonwalker.com/dev-to-comments-in-devtools.png\"></p>","fields":{"slug":"/blog/how-to-get-dev-comments-from-an-article-url/"},"frontmatter":{"date":"2020-05-20T10:00:00.000Z","devto_url":"","devto_id":"","title":"How to get Dev Comments from an article Url","description":"I want to incorporate some of the wonderful comments, ðŸ’•, ðŸ¦„, and ðŸ”–'s that I have been getting on dev.to on my website.  I have dabbled once or twice with no avail this time I am taking notes on my journey, so follow along and let's get there together.  By the end of this post, I will have a way to get comments from posts on the client-side thanks to the wonderfully open dev.to API.","path":"devto-comments-from-url","twitter_cover":null,"cover":{"absolutePath":"/home/runner/work/waylonwalkerv2/waylonwalkerv2/static/dev-to-comments-from-url.png","childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7EAAAOxAGVKw4bAAABsUlEQVQY00WQS2/TUBCFsweCE6ib5tnYDr6OfZ+x8SPutYkThaSplMpN1aYtgbZUpS9UKlh01Q0SEmKH2LBkyZ/gp3GtIiGdxYx0vhmdk3tSJ1dv/R+fw9dzl7rs/YnTCZLrT3ejzT1JMYtNq6Y7EMYW5BCtQdyFOIDEh8RD5HmupFKA2WDgJIMOpf74JYM+X1zeDPuzG35+xc8iNGqZAcIRRCHCISLd/3BZo8tNUqhhqYquu+8WnTcURI4W2Xr8tX/7fXh3GZ5knxFHmLctD7QdC3n/4BWVlFVS0YiswNPg6E/689f4y++Nb147SelsrzP/GJwRM9aAK+DGqp5/LEmFp7pBMPMy+F6yim0Qr6EhgZFhhSaLIIsB4zyZxv10fTLvJVNCnRe9RFFbJrKp7WdwRaOFChhs7BxefNjcP95enPYm25P0YLpz2BvPJluv4mE6Wt8NuiNZrj94mH+Ul6gtmnMzuKTg5Saq6bbBuGJ5deCIIpYaVrHaFpLKoFg15AZ8ZrgQhyb0TOTqliOS5gR5L8ELQF6FYhBr1oUm4lBxKHugZp56iynArrVYqSn8+C+FeWUBeMVMHgAAAABJRU5ErkJggg==","width":1000,"height":420,"src":"/static/8a88eb487d24bd558e6d66aeff3f3186/a8734/dev-to-comments-from-url.png","srcSet":"/static/8a88eb487d24bd558e6d66aeff3f3186/a8734/dev-to-comments-from-url.png 1x"},"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7EAAAOxAGVKw4bAAABsUlEQVQY00WQS2/TUBCFsweCE6ib5tnYDr6OfZ+x8SPutYkThaSplMpN1aYtgbZUpS9UKlh01Q0SEmKH2LBkyZ/gp3GtIiGdxYx0vhmdk3tSJ1dv/R+fw9dzl7rs/YnTCZLrT3ejzT1JMYtNq6Y7EMYW5BCtQdyFOIDEh8RD5HmupFKA2WDgJIMOpf74JYM+X1zeDPuzG35+xc8iNGqZAcIRRCHCISLd/3BZo8tNUqhhqYquu+8WnTcURI4W2Xr8tX/7fXh3GZ5knxFHmLctD7QdC3n/4BWVlFVS0YiswNPg6E/689f4y++Nb147SelsrzP/GJwRM9aAK+DGqp5/LEmFp7pBMPMy+F6yim0Qr6EhgZFhhSaLIIsB4zyZxv10fTLvJVNCnRe9RFFbJrKp7WdwRaOFChhs7BxefNjcP95enPYm25P0YLpz2BvPJluv4mE6Wt8NuiNZrj94mH+Ul6gtmnMzuKTg5Saq6bbBuGJ5deCIIpYaVrHaFpLKoFg15AZ8ZrgQhyb0TOTqliOS5gR5L8ELQF6FYhBr1oUm4lBxKHugZp56iynArrVYqSn8+C+FeWUBeMVMHgAAAABJRU5ErkJggg==","aspectRatio":2.380952380952381,"src":"/static/8a88eb487d24bd558e6d66aeff3f3186/a8734/dev-to-comments-from-url.png","srcSet":"/static/8a88eb487d24bd558e6d66aeff3f3186/2d6f8/dev-to-comments-from-url.png 250w,\n/static/8a88eb487d24bd558e6d66aeff3f3186/03ac3/dev-to-comments-from-url.png 500w,\n/static/8a88eb487d24bd558e6d66aeff3f3186/a8734/dev-to-comments-from-url.png 1000w","sizes":"(max-width: 1000px) 100vw, 1000px"}}}}}},"pageContext":{"id":"d775a10e-13cd-5b0c-86db-efe4037a5546"}}}