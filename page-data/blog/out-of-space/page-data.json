{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/out-of-space/","result":{"data":{"markdownRemark":{"id":"8270ea17-0228-5c2a-be87-2b9689ac39eb","html":"<p>This morning I logged into my machine and was nearly out of space</p>\n<ul>\n<li>64GB miniconda3!</li>\n<li>5GB conda cache</li>\n<li>4GM pip cache</li>\n<li>34GB docker</li>\n</ul>\n<h2>Find it</h2>\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--0LE2KZJW--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/je7pxcagfs7m23p98kck.jpg\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--0LE2KZJW--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/je7pxcagfs7m23p98kck.jpg\" alt=\"Looking for big files when the weeds are too tall\"></a></p>\n<blockquote>\n<p>Photo by <a href=\"https://unsplash.com/@simonmigaj?utm_source=unsplash&#x26;utm_medium=referral&#x26;utm_content=creditCopyText\">Simon Migaj</a> on <a href=\"https://unsplash.com/s/photos/find?utm_source=unsplash&#x26;utm_medium=referral&#x26;utm_content=creditCopyText\">Unsplash</a></p>\n</blockquote>\n<p>These are the commands that I often use to reclaim space.  Its so easy to fill up small vm's in the cloud, or in my case today let your dev machine go way too long without a good cleanup.</p>\n<h3>Show Remaining Space on Drives</h3>\n<p>This shows us where to start and gives a baseline of how much space we have reclaimed.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">df</span> -h</code></pre></div>\n<h3>show largest files in current directory</h3>\n<p>Next keep drilling into directories that are big and running this command to see whats big inside of it.  When you find somethign that you are willing to part with <code class=\"language-text\">rm -rf &lt;directory&gt;</code> it and check <code class=\"language-text\">df -h</code> to see if you have enough reclaimed yet.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">du</span> <span class=\"token builtin class-name\">.</span> -h --max-depth<span class=\"token operator\">=</span><span class=\"token number\">1</span></code></pre></div>\n<p>Honestly I rarely bother unless the directory is in the GB's of space.  A super simple filter for that is to just grep for G.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">du</span> <span class=\"token builtin class-name\">.</span> -h --max-depth<span class=\"token operator\">=</span><span class=\"token number\">1</span> <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> G</code></pre></div>\n<h2>conda</h2>\n<h3>How Many?</h3>\n<p>As a first baseline lets see how many enviroments we are starting with. I started with 71. Yeah I have had this machine for 2 years, and dont regularly remove them.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">conda info --envs <span class=\"token operator\">|</span> <span class=\"token function\">tail</span> -n +2 <span class=\"token operator\">|</span> <span class=\"token function\">wc</span> -l</code></pre></div>\n<p>bash</p>\n<h3>Lets batch it out!</h3>\n<p>We are devs here surely we can automate this issue! The following four lines will generate a list of existing conda environments, edit them with vim, remove the remaining ones, then remove the text file we created to remove from.</p>\n<p>Make sure that you only keep names of environments that you want to <strong>remove</strong> in <code class=\"language-text\">conda_envs_to_remove.txt</code> and delete the environment names you want to keep.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">conda info --envs <span class=\"token operator\">|</span> <span class=\"token function\">tail</span> -n +2 <span class=\"token operator\">|</span> <span class=\"token function\">cut</span> -d <span class=\"token string\">' '</span> -f1 <span class=\"token operator\">></span> conda_envs_to_remove.txt\n<span class=\"token function\">vim</span> conda_envs_to_remove.txt\n<span class=\"token function\">cat</span> ~/.conda_envs_remove <span class=\"token operator\">|</span> <span class=\"token function\">tr</span> <span class=\"token string\">'<span class=\"token entity\" title=\"\\n\">\\n</span>'</span> <span class=\"token string\">'<span class=\"token entity\" title=\"\\0\">\\0</span>'</span> <span class=\"token operator\">|</span> <span class=\"token function\">xargs</span> -l -0 conda remove --all -y -n\n<span class=\"token function\">rm</span> conda_envs_to_remove.txt</code></pre></div>\n<h3>üìù Side note</h3>\n<p>When I am creating one of these complicated bash pipelines including xargs I generally print out the command first and make sure that it does what I want. The following command will test the above script before doing dangerous things!</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">cat</span> ~/.conda_envs_remove <span class=\"token operator\">|</span> <span class=\"token function\">tr</span> <span class=\"token string\">'<span class=\"token entity\" title=\"\\n\">\\n</span>'</span> <span class=\"token string\">'<span class=\"token entity\" title=\"\\0\">\\0</span>'</span> <span class=\"token operator\">|</span> <span class=\"token function\">xargs</span> -l -0 <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"conda remove --all -y -n \"</span></code></pre></div>\n<h2>Cache</h2>\n<p>If your feeling really strained for space, you can <code class=\"language-text\">rm -rf ~/.cache</code>. Personally I like the improved speed of installing everything... obviously I install a lot of new environments.</p>\n<h2>Docker</h2>\n<p><a href=\"https://res.cloudinary.com/practicaldev/image/fetch/s--W4NWBxYC--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/olcef3lh31dtrwa51u7g.jpg\"><img src=\"https://res.cloudinary.com/practicaldev/image/fetch/s--W4NWBxYC--/c_limit%2Cf_auto%2Cfl_progressive%2Cq_auto%2Cw_880/https://dev-to-uploads.s3.amazonaws.com/i/olcef3lh31dtrwa51u7g.jpg\" alt=\"Alt Text\"></a></p>\n<blockquote>\n<p>Photo by <a href=\"https://unsplash.com/@henry_be?utm_source=unsplash&#x26;utm_medium=referral&#x26;utm_content=creditCopyText\">Henry Be</a> on <a href=\"https://unsplash.com/s/photos/dark-fire?utm_source=unsplash&#x26;utm_medium=referral&#x26;utm_content=creditCopyText\">Unsplash</a></p>\n</blockquote>\n<p>For more information read this article, <a href=\"https://docs.docker.com/config/pruning/\" title=\"https://docs.docker.com/config/pruning/\">https://docs.docker.com/config/pruning/</a>. I have all of the images that I want pushed remotely so I just dumped everything with the following command.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">docker system prune</code></pre></div>\n<p>Running these two sets of commands cleared up about <strong>70GB</strong> of space for me with very little effort on my behalf. I hope others find the first command helpful to batch remove many conda environments at once.</p>","fields":{"slug":"/blog/out-of-space/"},"frontmatter":{"date":"2020-02-01T06:00:00.000Z","devto_url":null,"devto_id":null,"title":"Out of Space","description":"Out of Space! How to remove 65 conda environments in one command.","path":"out-of-space","twitter_cover":{"absolutePath":"/home/runner/work/waylonwalkerv2/waylonwalkerv2/static/photo-1464802686167-b939a6910659.jpg","childImageSharp":{"fixed":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAMFAQL/xAAWAQEBAQAAAAAAAAAAAAAAAAADAAH/2gAMAwEAAhADEAAAAZTunsc40y//xAAaEAACAwEBAAAAAAAAAAAAAAAAAgEDIRMx/9oACAEBAAEFAork5ZKlbFnjPv8A/8QAFREBAQAAAAAAAAAAAAAAAAAAACH/2gAIAQMBAT8BV//EABYRAQEBAAAAAAAAAAAAAAAAAAABEf/aAAgBAgEBPwFsf//EABYQAQEBAAAAAAAAAAAAAAAAAAEQIP/aAAgBAQAGPwLAz//EABkQAQEBAQEBAAAAAAAAAAAAAAEAESExUf/aAAgBAQABPyHIP2fS62AckBN7bbC//9oADAMBAAIAAwAAABC0/wD/xAAVEQEBAAAAAAAAAAAAAAAAAAAREP/aAAgBAwEBPxBY/8QAFhEBAQEAAAAAAAAAAAAAAAAAARAR/9oACAECAQE/ENCH/8QAGxABAAMBAAMAAAAAAAAAAAAAAQARMSFRgcH/2gAIAQEAAT8QWdsyX33NShfMoY6Q3HU1iLSvsVqAz//Z","width":800,"height":418,"src":"/static/09cad1647f05b649e3ea38af99dba6b7/5d469/photo-1464802686167-b939a6910659.jpg","srcSet":"/static/09cad1647f05b649e3ea38af99dba6b7/5d469/photo-1464802686167-b939a6910659.jpg 1x,\n/static/09cad1647f05b649e3ea38af99dba6b7/3d47d/photo-1464802686167-b939a6910659.jpg 1.5x"}}},"cover":{"absolutePath":"/home/runner/work/waylonwalkerv2/waylonwalkerv2/static/photo-1464802686167-b939a6910659.jpg","childImageSharp":{"fixed":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAMFAQL/xAAWAQEBAQAAAAAAAAAAAAAAAAADAAH/2gAMAwEAAhADEAAAAZTunsc40y//xAAaEAACAwEBAAAAAAAAAAAAAAAAAgEDIRMx/9oACAEBAAEFAork5ZKlbFnjPv8A/8QAFREBAQAAAAAAAAAAAAAAAAAAACH/2gAIAQMBAT8BV//EABYRAQEBAAAAAAAAAAAAAAAAAAABEf/aAAgBAgEBPwFsf//EABYQAQEBAAAAAAAAAAAAAAAAAAEQIP/aAAgBAQAGPwLAz//EABkQAQEBAQEBAAAAAAAAAAAAAAEAESExUf/aAAgBAQABPyHIP2fS62AckBN7bbC//9oADAMBAAIAAwAAABC0/wD/xAAVEQEBAAAAAAAAAAAAAAAAAAAREP/aAAgBAwEBPxBY/8QAFhEBAQEAAAAAAAAAAAAAAAAAARAR/9oACAECAQE/ENCH/8QAGxABAAMBAAMAAAAAAAAAAAAAAQARMSFRgcH/2gAIAQEAAT8QWdsyX33NShfMoY6Q3HU1iLSvsVqAz//Z","width":1000,"height":420,"src":"/static/09cad1647f05b649e3ea38af99dba6b7/9cf42/photo-1464802686167-b939a6910659.jpg","srcSet":"/static/09cad1647f05b649e3ea38af99dba6b7/9cf42/photo-1464802686167-b939a6910659.jpg 1x"},"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAOABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMFAf/EABYBAQEBAAAAAAAAAAAAAAAAAAMAAf/aAAwDAQACEAMQAAABlsa1jnGmX//EABkQAAMBAQEAAAAAAAAAAAAAAAABAgMhE//aAAgBAQABBQJZs8hyRRpxVff/xAAVEQEBAAAAAAAAAAAAAAAAAAAAIf/aAAgBAwEBPwFX/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAECAQE/AWx//8QAFhABAQEAAAAAAAAAAAAAAAAAARAg/9oACAEBAAY/AsDP/8QAGRAAAwEBAQAAAAAAAAAAAAAAAAERIUFR/9oACAEBAAE/IcXaPFNSUwdIL6UdpH//2gAMAwEAAgADAAAAEPD/AP/EABcRAAMBAAAAAAAAAAAAAAAAAAABESH/2gAIAQMBAT8Qt0Q//8QAFhEBAQEAAAAAAAAAAAAAAAAAARAR/9oACAECAQE/ENCH/8QAGxABAQEBAAMBAAAAAAAAAAAAAREAITFBUWH/2gAIAQEAAT8QDdg2DYfuc8VT7ukfWMo6dwhNRNzwHf/Z","aspectRatio":2.380952380952381,"src":"/static/09cad1647f05b649e3ea38af99dba6b7/9cf42/photo-1464802686167-b939a6910659.jpg","srcSet":"/static/09cad1647f05b649e3ea38af99dba6b7/ff9d4/photo-1464802686167-b939a6910659.jpg 250w,\n/static/09cad1647f05b649e3ea38af99dba6b7/2dc04/photo-1464802686167-b939a6910659.jpg 500w,\n/static/09cad1647f05b649e3ea38af99dba6b7/9cf42/photo-1464802686167-b939a6910659.jpg 1000w,\n/static/09cad1647f05b649e3ea38af99dba6b7/48be0/photo-1464802686167-b939a6910659.jpg 1200w","sizes":"(max-width: 1000px) 100vw, 1000px"}}}}}},"pageContext":{"id":"8270ea17-0228-5c2a-be87-2b9689ac39eb"}}}